/* curtin-library.bitbucket.org/virtual-bookshelf/LICENSE */(function($){var n=void 0,w=!0,y=null,F=!1,aa=1<window.devicePixelRatio?window.devicePixelRatio:1;function H(){return(new Date).getTime()}var ba="Webkit Moz O Ms Khtml webkit moz o ms khtml".split(" ");function K(a,c){if(a)for(var b=1;b<arguments.length;++b){var g=arguments[b];if(g in a)return g;for(var g=g.slice(0,1).toUpperCase()+g.slice(1),k=0;k<ba.length;++k){var q=ba[k]+g;if(q in a)return q}}}function L(a,c,b){a.each(function(){var a=K(this.style,c);a&&(this.style[a]=b)})}
var M=function(){var a=K(window,"requestAnimationFrame");return a?function(c){return window[a](c)}:function(c){return window.setTimeout(c,1)}}(),ca=function(){var a=K(window,"cancelAnimationFrame","cancelRequestAnimationFrame")||"clearTimeout";return function(c){window[a](c)}}();function da(a){a&&a.remove&&a.remove()}function ea(a){this.a=a}ea.prototype.next=function(){this.a=279470273*this.a%4294967291;return this.a/4294967291};var N="ontouchstart"in window,fa=100,ga=500,ha="mouseup dragstart losecapture",ka="mouseup dragstart mousemove";
function oa(a,c){function b(b){return a&&v[b.type].apply(this,arguments)}function g(b){b({pageX:f[f.length-1].x,pageY:f[f.length-1].y,e:t.x,M:t.y,H:B,O:C})}function k(){p&&(p=F,d&&(d.unbind(ha,b),d.get(0).releaseCapture(),d=n),$(window).unbind(ka,b))}function q(c,g){e=c;t={x:g.pageX,y:g.pageY,time:H()};f=[t];C=B=0;!N&&!p&&(p=w,l&&!d&&(d=a,d.bind(ha,b),d.get(0).setCapture(F)),$(window).bind(ka,b))}function r(b){var c=f[f.length-1];b={x:b.pageX,y:b.pageY,time:H()};for(f.push(b);2<f.length&&b.time-f[0].time>
fa;)f.shift();var d=f[0];if(b.time-d.time>=ga)f.shift(),C=B=0;else{var a=b.time-d.time;0<a&&(B=(b.x-d.x)/a,C=(b.y-d.y)/a)}return b.x!=c.x||b.y!=c.y}function u(b,d){if(r(b)){var a=f[f.length-1];if(!h){var k=6<=Math.abs(a.x-t.x),a=6<=Math.abs(a.y-t.y);c.p&&k||c.q&&a?h=w:N&&(!c.p&&k||!c.q&&a)&&s(b,w)}h&&d.preventDefault();e!==n&&g(c.F)}}function s(b,d){k();e=n;A&&(h?setTimeout(A,1):A(),A=y);h=F;b&&r(b);d&&(C=B=0);g(c.D)}function m(b){var d=G;G={pageX:b.pageX,pageY:b.pageY};(d?c.B:c.C)({pageX:b.pageX,
pageY:b.pageY})}var l=a.get(0).setCapture&&a.get(0).releaseCapture,e,h,p,d,t,f,B,C,G,A=y,v={},x=Infinity;v.touchstart=function(b){if(e!==n){for(var d=b.touches||b.originalEvent.touches,a=F,f=0;f<d.length&&!(a=d[f].identifier==e);++f);a||s(n,w)}e===n&&!b.defaultPrevented&&(b=(b.changedTouches||b.originalEvent.changedTouches)[0],q(b.identifier,b),g(c.t))};v.touchmove=function(b){for(var d=b.changedTouches||b.originalEvent.changedTouches,c=0;c<d.length;++c){var a=d[c];if(a.identifier==e){u(a,b);break}}};
v.touchend=function(b){for(var d=b.changedTouches||b.originalEvent.changedTouches,c=0;c<d.length;++c){var a=d[c];if(a.identifier==e){s(a,"touchcancel"==b.type);break}}};v.touchcancel=v.touchend;v.mouseenter=function(b){d||m(b)};v.mouseleave=function(){d||G&&(G=n)};v.mousedown=function(b){if(1==b.which&&e===n&&!b.defaultPrevented){q("mouse",b);e="mouse";g(c.t);if(b.target&&!A){var d=$(b.target),a=function(b){b.stopPropagation();return F};A=function(){d.unbind("click",a)};d.bind("click",a)}return F}};
v.mousemove=function(b){"mouse"==e?(l&&($(b.target).closest(a).length?m(b):G&&(G=n)),u(b,b)):e===n&&m(b)};v.mouseup=function(b){1==b.which&&"mouse"==e&&s(b,F)};v.dragstart=function(){return F};v.mousewheel=v.DOMMouseScroll=function(b){var d=b.originalEvent;if(!d.defaultPrevented){var a=-d.detail||d.wheelDelta/120||0,f=0,e=a;d.axis!==n&&d.axis===d.HORIZONTAL_AXIS?(e=0,f=a):d.wheelDeltaX!==n&&d.wheelDeltaY!==n&&(f=d.wheelDeltaX/120,e=d.wheelDeltaY/120);0!=a&&(x=Math.max(1,Math.min(Math.abs(a),x)),c.G({I:a,
J:f,K:e,step:a/x,v:f/x,N:e/x}),b.preventDefault())}};v.losecapture=v.contextmenu=function(){e!==n&&s(n,w)};v.selectstart=function(){return F};this.remove=function(){N?a.unbind("touchstart touchmove touchend touchcancel",b):a.unbind("mousedown mouseenter mouseleave mousemove contextmenu mousewheel DOMMouseScroll selectstart",b);k();A&&(A(),A=y)};N?a.bind("touchstart touchmove touchend touchcancel",b):a.bind("mousedown mouseenter mouseleave mousemove contextmenu mousewheel DOMMouseScroll selectstart",
b)};var Q;function R(a){this.element=a;this.a=this.element.get(0);Q(this.a)}function S(a,c,b,g,k){this.element=a;this.a=this.element.get(0);this.x=c;this.y=b;this.width=g;this.height=k;Q(this.a)}
(function(){var a=$("<div>").get(0).style,c=K(a,"transform"),b=K(a,"transformOrigin");Q=b?function(a){a.style.position="absolute";a.style[b]="0 0";a.style.left=0;a.style.top=0}:function(b){b.style.position="absolute"};c&&b&&K(a,"perspective")?(R.prototype.c=function(b,a){this.a.style[c]="translate3d("+b.toFixed(3)+"px,"+a.toFixed(3)+"px,0)"},S.prototype.c=function(b,a,q,r,u){this.a.style[c]="translate3d("+(b+this.x*r).toFixed(3)+"px,"+(a+this.y*u).toFixed(3)+"px,0) scale3d("+r.toFixed(3)+","+u.toFixed(3)+
",1)";this.a.style.zIndex=Math.floor(q)}):(R.prototype.c=function(b,a){this.a.style.left=Math.round(b)+"px";this.a.style.top=Math.round(a)+"px"},S.prototype.c=function(b,a,c,r,u){b+=this.x*r;a+=this.y*u;r=b+this.width*r;u=a+this.height*u;b=Math.round(b);a=Math.round(a);this.a.style.left=b+"px";this.a.style.top=a+"px";this.a.style.width=Math.round(r-b)+"px";this.a.style.height=Math.round(u-a)+"px";this.a.style.zIndex=Math.floor(c)})})();function pa(a,c,b){function g(D,c){d.splice(c,0,this);this.id=D;this.a=[];this.loaded=F;this.h=this.next=y;this.width=0;var e=this;t.loadSegment(D,f,function(D){if(!e.z){var h=D.length;e.k=D;e.next=D.next;e.h=D.prev;e.next==e&&!h&&delete e.next;e.h==e&&!h&&delete e.h;e.c&&e.c.remove();e.c=b.n(D,a);e.loaded=w;e.width=h*b.b;if(c==d.length-1)for(h=0;h<D.length;++h)e.a.push(t.createItem(e.k,h,f));else for(h=D.length-1;0<=h;--h)e.a[h]=t.createItem(e.k,h,f);for(h=0;h<e.a.length;++h)e.c.r(e.a[h],h);e.o();
E=y;p()}});this.loaded||(this.width=b.b,this.c=b.m(a),this.o())}function k(b,a,c){r();b=Math.round(d[0].x+b);for(var e=0;e<d.length;++e){var f=d[e];f.e=f.x;f.d=b;b+=f.width}p();G=H();A=a;v=c;B=M(u)}function q(){for(var b=0;b<d.length;++b){var a=d[b];a.x=a.e=a.d}p();e()}function r(){clearTimeout(I);I=n;ca(B);B=n}function u(){B=n;var a=H()-G;if(a>=A)q();else{v(a);var a=b.marginWidth,c=b.f-b.marginWidth;if(d[0].x>a){for(c=0;c<d.length;++c){var e=d[c];e.d=a;a+=e.width}q()}else if(d[d.length-1].x+d[d.length-
1].width<c){a=c;for(c=d.length-1;0<=c;--c)e=d[c],a-=e.width,e.d=a;q()}else B=M(u)}h()}function s(a){z=a;ia=0<z?-1:1;a=0.5*z*z/(0>z?-x:x);if(ta){var c=d[0].x-b.marginWidth+a;a+=Math.round(c/b.b)*b.b-c}c=(d[0].x-b.marginWidth)/b.b;if(0>a){var c=Math.ceil(c)-c,e=Math.ceil(c-a/b.b);e>O&&(a=(c-O)*b.b)}else c-=Math.floor(c),e=Math.ceil(c+a/b.b),e>O&&(a=(O-c)*b.b);0!=a&&(z=Math.sqrt(Math.abs(2*a*x)),0>a&&(z=-z),k(a,z/(0>z?-x:x),m))}function m(b){for(var a=0>z?-x:x,c=0;c<d.length;++c){var e=d[c];e.x=e.e+
z*b-0.5*a*b*b}}function l(b){b/=A;b=0.5*(1-Math.cos(b*Math.PI));for(var a=0;a<d.length;++a){var c=d[a];c.x=c.e+b*(c.d-c.e)}}function e(){B===n&&(I===n&&0<d.length&&!J&&ja!=y)&&(I=window.setTimeout(function(){I=n;var a=((b.f-b.b)/2-d[0].x)%b.b,c=0.25*b.i;if(0>ia){for(;a<=c;)a+=b.b;a+=0*b.b}else{for(;a>=-c;)a-=b.b;a-=0*b.b}k(a,sa,l)},ja))}function h(){for(var b=0;b<d.length;++b)d[b].w()}function p(){C===n&&(C=setTimeout(function(){C=n;if(d.length){for(var a=b.f,c=d[0],e=d[d.length-1];Math.max(c.x,c.d)+
c.width<-la;)d.shift().remove(),c=d[0];for(;Math.min(e.x,e.d)>a+la;)d.pop().remove(),e=d[d.length-1];Math.max(c.x,c.d)>-ma&&c.h!=y&&new g(c.h,0);Math.min(e.x,e.d)+e.width<a+ma&&e.next!=y&&new g(e.next,d.length)}},1))}var d=[],t=c.stream,f,B,C,G,A,v,x=c.drag||0.0020,z,I,ia=0>c.stepDirection?-1:1,ja="stepInterval"in c?c.stepInterval:3E3,sa="stepDuration"in c?c.stepDuration:1E3,J,na="preload"in c?c.preload:20,ma=b.b*na,la=3*b.b*na/2,E=c.startItem,W=y,ta=c.rounding,P=c.maxThrowVelocity||4,O=c.maxThrowItems||
Infinity;g.prototype.o=function(){var a=d[1],c=d[d.length-2];if(this.loaded&&E!==y){if("function"==typeof E){a=E;E=y;for(c=0;c<this.a.length;++c)if(a(this.a[c])){E=c;break}}this.d=this.e=this.x=0<=E&&E<this.a.length?(b.f-b.b)/2-E*b.b:0;E=y}else this==d[0]&&a&&a.loaded?(this.x=a.x-this.width,this.e=a.e-this.width,this.d=a.d-this.width):this==d[d.length-1]&&c&&c.loaded?(this.x=c.x+c.width,this.e=c.e+c.width,this.d=c.d+c.width):this.d=this.e=this.x=0;this.w()};g.prototype.w=function(){this.c.j(this.x);
var a=Math.floor((b.f/2-this.x)/b.b);if(0<=a&&(a<this.a.length&&this.a[a]!=W)&&(W=this.a[a],c.onItemFocused))c.onItemFocused(W,this.id,a)};g.prototype.remove=function(){this.z=w;this.c&&this.c.remove();for(delete this.k;this.a.length;)da(this.a.pop())};this.remove=function(){clearTimeout(C);C=n;for(r();0<d.length;)da(d.pop())};this.refresh=function(){B===n&&(h(),p())};this.a=function(a){if(!J&&0<d.length){var c=0<a?b.f+b.b-b.i-b.marginWidth:b.marginWidth;a=(0<a?Math.floor:Math.ceil)((d[0].d-c)/b.b-
a+(0<a?1:-1)*b.u)*b.b+c-d[0].x;c=Math.sqrt(Math.abs(2*a*x));0>a&&(c=-c);s(c)}};this.c=function(a){this.a(a*Math.max(1,Math.floor((b.f-2*b.marginWidth)/b.b)))};f={itemWidth:b.i,itemHeight:b.s,itemSpacing:b.b,refresh:this.refresh};new g(c.startSegment||0,0);p();new oa(a,{p:w,q:F,t:function(){if(J=1<d.length||d[0].loaded){r();for(var a=z=0;a<d.length;++a){var b=d[a];b.e=b.d=b.x}}},F:function(a){if(J){a=a.pageX-a.e;var c=b.f,e=d[0],f=e.e;e.h!=y&&(f-=b.b);var g=d[d.length-1],e=g.e+g.width;g.next!=y&&(e+=
b.b);g=b.marginWidth;a=Math.max(a,c-b.marginWidth-e);a=Math.min(a,g-f);for(c=0;c<d.length;++c)f=d[c],f.x=f.d=f.e+a;h();p()}},D:function(a){J&&(s(Math.max(-P,Math.min(a.H,P))),J=F,e())},G:function(a){if(!J&&0<d.length){a=d[0].d-d[0].x+(Math.abs(a.step)>=Math.abs(a.v)?a.step:a.v)*b.b;var c=Math.sqrt(Math.abs(2*a*x));0>a&&(c=-c);s(Math.max(-P,Math.min(c,P)))}},C:function(){},L:function(){},B:function(){clearTimeout(I);I=n;e()}});e()};function T(a,c){function b(){q.onload=y;q.onerror=y;k.width=c.itemWidth;k.height=Math.round(this.height*c.itemWidth/this.width);k.height>c.itemHeight&&(k.width=Math.round(this.width*c.itemHeight/this.height),k.height=c.itemHeight);g.width(k.width).height(k.height).append($(q).css({width:"100%",height:"100%",border:"none"}));c.refresh()}var g=$("<a>").attr("href",a.link).attr("target",a.target).attr("title",a.title).css("display","inline-block");this.element=g;this.height=this.width=0;this.data=a;
var k=this,q=new Image;q.onload=b;q.onerror=b;q.src=a.image};var qa=$.browser.msie&&/^[1-8]\./.test($.browser.version),U,V=[];function X(){U=y;try{V.shift()()}finally{V.length&&(U=setTimeout(X,1))}};function Y(a,c){c=c||{};this.c=a;this.a={A:!("looping"in c)||c.looping,l:c.itemType||T}}Y.prototype.loadSegment=function(a,c,b){c=this.a.A?a:n;b({id:a,prev:c,next:c,length:this.c.length})};Y.prototype.createItem=function(a,c,b){return new this.a.l(this.c[c],b)};function ra(a,c){c=c||{};this.c=a;this.a={l:c.itemType||T}}ra.prototype.loadSegment=function(a,c,b){$.getJSON(this.c+a,function(c){b({id:a,h:c.prev,next:c.next,length:c.items.length,g:c.items})})};ra.prototype.createItem=function(a,c,b){return new this.a.l(a.g[c],b)};var Z=window.VirtualBookshelf||(window.VirtualBookshelf={});
Z.Bookshelf=function(a,c){function b(a,b){this.element=$("<div>").css({width:a.length*u+"px",height:r+"px"});this.a=new R(this.element);b.append(this.element)}a=$(a);L(a,"userSelect","none");a.css("overflow","hidden");/^(absolute|fixed)$/.test(a.css("position"))||a.css("position","relative");var g=c.spacing||1,k=a.width(),q=a.height(),r=c.itemHeight||q,u=c.itemWidth||r*(c.itemAspect||1),q=c.marginWidth||0,s=Math.round(u*g);b.prototype.j=function(a){this.a.c(Math.round(a*aa)/aa,0)};b.prototype.r=function(a,
b){this.element.append($(a.element).css("position","absolute").css("left",Math.round(s*b)+"px"))};b.prototype.remove=function(){this.element.remove()};var m={i:u,s:r,b:s,f:k,marginWidth:q,u:0.9,n:function(a,c){return new b(a,c)},m:function(a){a=new b({length:1},a);a.element.append($("<div>").css({width:u+"px",height:r+"px"}));return a}},l=new pa(a,c,m);this.remove=function(){l.remove();l=n};this.refresh=function(){m.f=k=a.width();l.refresh()};this.step=function(a){l.a(a)};this.stepPage=function(a){l.c(a)}};
Z.Carousel=function(a,c){function b(a,b){this.a=b;this.g=[];this.visible=F}function g(a,b){this.element=$(a.element).hide();this.c=a;this.visible=F;this.a=new S(this.element,0,0,0,0);b.append(this.element)}a=$(a);L(a,"userSelect","none");a.css("user-select","none");/^(absolute|fixed)$/.test(a.css("position"))||a.css("position","relative");var k=c.spacing||1.2,q=c.tilt||0,r="perspective"in c?c.perspective:1,u=a.width(),s=a.height(),m=c.itemHeight||s,l=c.itemWidth||m*(c.itemAspect||1),e=l*k,h="fade"in
c?c.fade:0.1,p=k*u/2,d=Math.PI*p;"startItem"in c||(c.startItem=Math.ceil(d/2/e));b.prototype.j=function(a){this.visible||(this.visible=a<d&&a>-this.g.length*e);if(this.visible){for(var b,c=0;c<this.g.length;++c){var h=this.g[c];h.j(a+e*c);b=b||h.visible}this.visible=b}};b.prototype.r=function(a,b){this.g[b]=new g(a,this.a)};b.prototype.remove=function(){for(var a=0;a<this.g.length;++a)this.g[a].element.remove()};g.prototype.j=function(a){a=(e+a)/(e+d);var b=0<a&&1>a;if(b){var c=a*Math.PI,g=1-Math.sin(c),
k=1/(1+r*g),c=u/2-k*p*Math.cos(c),t=s*q*g,x=this.c.width,z=this.c.height;this.a.x=(l-x)/2;this.a.y=m-z;this.a.width=x;this.a.height=z;this.a.c(c-k*l/2,t+m-k*m,1E3*(1-g),k,k);this.element.css("opacity",(a<h?a/h:a>1-h?(1-a)/h:1).toFixed(3))}this.visible!=b&&(this.visible=b,this.element.toggle(b))};var t=new pa(a,c,{i:l,s:m,b:e,f:d,marginWidth:(d-l)/2,u:0.5,n:function(a,c){return new b(0,c)},m:function(a){return new b(0,a)}});this.remove=function(){t.remove();t=n};this.refresh=function(){t.refresh()};
this.step=function(a){t.a(a)}};Z.ArrayStream=Y;Z.JSONStream=ra;
Z.FadeTransition=function(a,c,b,g){function k(a,b){a.css("opacity",Math.max(0.01,Math.min(b,1)))}function q(){t=d=n;var f=H();p&&(h&&(f<e?k(l,(e-f)/c):(l.remove(),h=F)),h||(l=p,p=n,e=Math.max(f,Math.max(f,m)+b)+g));l&&!p&&f>=e-g&&(h||(l=$(l)),k(l,1-(e-f)/g),h||(a.append(l),h=w));s&&(f<m?k(s,(m-f)/c):(s.remove(),s=n));s||f>=e-g&&f<e?d=M(q):f<e&&(t=setTimeout(q,e-g-f))}function r(){clearTimeout(t);t=n;ca(d);d=n}b=b||0;g=0<=g?g:c;var u=H(),s,m=u,l,e=u,h,p,d,t;this.show=function(a){r();if(!p){var b=H();
e=b+Math.min(1,1-(e-b)/g)*c}p=a;s||(h&&(s=l,m=e,h=F),l=n);q()};this.remove=r};Z.SimpleItem=T;
Z.SubstituteImage=function(a,c,b,g,k,q,r){function u(a){if(qa){var b=a.position();a.before($('<div class="shelf-ie-box-shadow">').css({left:b.left-5+"px",top:b.top-4+"px",width:a.outerWidth()+"px",height:a.outerHeight()+"px"}))}else L(a,"boxShadow",r.boxShadow)}function s(){var c=new ea(b),h="rgb(#,#,#)".replace(/#/g,function(){return Math.floor(256*(0.4+0.4*c.next()))}),h=$('<div class="shelf-image-substitute">').css("background-color",h);a.append(h);var p,d=h.width(),t=h.height(),f=$('<div class="shelf-image-authors static">');
if(q)for(var l=0;l<q.length;++l)f.append($("<div>").text(q[l]));h.append(f);for(p=r.authorsFontSize;1<p&&(f.outerHeight()>r.authorsMaxHeight||f.outerWidth()>d);)--p,f.css("font-size",p+"px");f.removeClass("static");var m,s=0;if(k){m=$('<div class="shelf-image-subtitle">').text(k);h.prepend("<br>").prepend(m);for(p=r.subtitleFontSize;1<p&&(m.outerHeight()>r.subtitleMaxHeight||m.outerWidth()>d);)--p,m.css("font-size",p+"px");s=m.outerHeight()}l=$('<div class="shelf-image-title">').text(g);h.prepend("<br>").prepend(l);
p=r.titleFontSize;for(var A=t-f.outerHeight()-s;1<p&&(l.outerHeight()>A||l.outerWidth()>d);)--p,h.css("font-size",p+"px");d=l.outerHeight()+s;t=Math.floor(Math.max(0,Math.min(0.2*(t-d),(t-f.outerHeight()-d)/2)));l.css("top",t+"px");m&&m.css("top",t+"px");qa&&(h.addClass("shelf-ie-no-text-shadow"),l.prepend($('<div class="shelf-ie-text-shadow">').text(g)),m&&m.prepend($('<div class="shelf-ie-text-shadow">').text(k)),f.prepend($('<div class="shelf-ie-text-shadow">').append(f.children().clone())));u(h);
h.prepend($('<div class="shelf-image-bg">').css("background-image",'url("'+r.background+'")'))}if(c){var m=new Image,l=function(){m.onload=y;m.onerror=y;setTimeout(function(){var b=m.width,c=m.height;if(1<b&&1<c){var g=$(m),d=a.width(),k=a.height();c>k&&(b=Math.round(b*k/c),c=k);b>d&&(c=Math.round(c*d/b),b=d);g.css({width:b.toFixed()+"px",height:c.toFixed()+"px",position:"relative",top:(k-c).toFixed()+"px"});a.append(g);u(g)}else V.push(s),U||(U=setTimeout(X,1))},1)};m.onload=l;m.onerror=l;m.src=
c}else V.push(s),U||(U=setTimeout(X,1))};})(jQuery)
